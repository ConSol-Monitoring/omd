#!/usr/bin/python3

import sys

sys.stdout.buffer.write(b"""#
# This file has been created by OMD out of the following files:
#
""")

for fn in sys.argv[1:]:
    if fn.endswith('~'):
        continue
    sys.stdout.buffer.write(("# %s\n" % fn).encode("UTF-8"))

sys.stdout.buffer.write(b"""#
# Do not edit this file. It will be recreated each time Nagios
# is started or reloaded. Rather change things in the original
# files.
# 
# ------------------------------------------------------------

""")

for fn in sys.argv[1:]:
    if fn.endswith('~'):
        continue
    lineno = 0
    contline = b""
    for line in open(fn, "rb"):
        lineno += 1
        ls = line.strip()
        if ls == b"" or ls.startswith(b"#"):
            continue
        if ls[-1] == '\\':
            contline += ls[:-1] + b" "
            continue

        sys.stdout.buffer.write(("# %s:%d\n" % (fn, lineno)).encode("UTF-8"))
        sys.stdout.buffer.write(contline + line)
        contline = b""
